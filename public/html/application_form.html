<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Form - PSAU Admission System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* ML Scan Results Styling */
        #ml-scan-results .card {
            border: 2px solid #17a2b8;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        #ml-scan-results .card-header {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        
        #scan-loading .spinner-border {
            width: 3rem;
            height: 3rem;
        }
        
        #extracted-text {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border: 1px solid #dee2e6;
        }
        
        .badge.fs-6 {
            font-size: 0.9rem !important;
            padding: 0.5rem 0.75rem;
        }
        
        .analysis-details {
            background-color: #f8f9fa;
            border-left: 4px solid #17a2b8;
        }
        
        /* Animation for scan results */
        #ml-scan-results {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Navigation -->
    <?php include 'templates/mobile.html'; ?>
    
    <!-- Desktop Navigation -->
    <div class="desktop-nav">
        <!-- Navigation Bar -->
        <?php include 'templates/navbar.html'; ?>
        
        <!-- Sidebar -->
        <?php include 'templates/sidebar.html'; ?>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="container-fluid">
            <!-- Page Title -->
            <div class="page-title">
                <h2>Application Form</h2>
                <p class="lead">Upload your grades document to submit your application.</p>
            </div>
            
            <?php if (!empty($message)): ?>
                <div class="alert alert-<?php echo $messageType; ?> alert-dismissible fade show" role="alert">
                    <?php echo $message; ?>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            <?php endif; ?>
            
            <div class="row">
                <div class="col-lg-8">
                    <div class="upload-container">
                        <?php if (!$canSubmit): ?>
                            <div class="text-center py-4">
                                <i class="bi bi-exclamation-circle display-1 text-warning"></i>
                                <h4 class="mt-3">Application Already In Progress</h4>
                                <p>You already have an active application in progress. You cannot submit a new one at this time.</p>
                                <a href="application_progress.php" class="btn btn-primary mt-3">
                                    <i class="bi bi-graph-up"></i> View Application Progress
                                </a>
                            </div>
                        <?php else: ?>
                            <h4 class="mb-4">Upload Your Grades Document</h4>
                            
                            <?php if ($disableUpload): ?>
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>Your application has been submitted.</strong>
                                <p class="mt-2 mb-0">The document upload is currently disabled as your application is being processed. If your application is rejected, you will be able to resubmit your documents.</p>
                                <a href="application_progress.php" class="btn btn-sm btn-primary mt-3">
                                    <i class="bi bi-graph-up"></i> View Application Progress
                                </a>
                            </div>
                            <?php endif; ?>
                            
                            <div class="instructions-card mb-4">
                                <h5><i class="bi bi-info-circle"></i> Important Instructions</h5>
                                <ul>
                                    <li>The document must be in PDF format.</li>
                                    <li>The file size should not exceed 5MB.</li>
                                    <li>The document must contain both 1st Grading and 2nd Grading information.</li>
                                    <li>Make sure the document is clear and readable.</li>
                                    <li>All information in the document must be accurate and complete.</li>
                                    <li><strong>AI Analysis:</strong> Our system will automatically analyze your document to verify it's a report card and check for any failed remarks or grades. This analysis is advisory only - you can still submit your application regardless of the results.</li>
                                </ul>
                            </div>
                            
                            <form method="POST" action="application_form.php" enctype="multipart/form-data" id="uploadForm" <?php echo $disableUpload ? 'style="opacity: 0.7; pointer-events: none;"' : ''; ?>>
                                <!-- Educational Background Section -->
                                <h4 class="mb-3">Educational Background</h4>
                                
                                <div class="mb-3">
                                    <label for="previous_school" class="form-label">Previous School <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="previous_school" name="previous_school" 
                                           placeholder="Example: Pampanga High School, Angeles City" required <?php echo $disableUpload ? 'disabled' : ''; ?>>
                                    <small class="text-muted">Enter complete school name and location</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="school_year" class="form-label">School Year <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="school_year" name="school_year" 
                                           placeholder="Example: 2023-2024" required <?php echo $disableUpload ? 'disabled' : ''; ?>>
                                    <small class="text-muted">Format: YYYY-YYYY (e.g., 2023-2024)</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="strand" class="form-label">Senior High Track/Strand <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="strand" name="strand" 
                                           list="strandOptions" placeholder="Select or type your Senior High Track/Strand" 
                                           required <?php echo $disableUpload ? 'disabled' : ''; ?>>
                                    <datalist id="strandOptions">
                                        <option value="STEM">STEM - Science, Technology, Engineering, and Mathematics</option>
                                        <option value="ABM">ABM - Accountancy, Business, and Management</option>
                                        <option value="HUMSS">HUMSS - Humanities and Social Sciences</option>
                                        <option value="TVL">TVL - Technical-Vocational-Livelihood</option>
                                        <option value="GAS">GAS - General Academic Strand</option>
                                        <option value="Arts and Design">Arts and Design</option>
                                        <option value="Sports">Sports</option>
                                    </datalist>
                                    <small class="text-muted">Select from the list or type your own Track/Strand</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="gpa" class="form-label">General Average/GPA <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="gpa" name="gpa"
                                        min="75" max="100" step="0.01" required <?php echo $disableUpload ? 'disabled' : ''; ?>>
                                    <small class="text-muted">Enter your general average/GPA (75-100)</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address <span class="text-danger">*</span></label>
                                    <textarea class="form-control" id="address" name="address" rows="3" 
                                              placeholder="Example: 123 Main Street, Barangay San Vicente, San Fernando, Pampanga" 
                                              required <?php echo $disableUpload ? 'disabled' : ''; ?>></textarea>
                                    <small class="text-muted">Enter complete address (House/Building Number, Street, Barangay, City/Municipality, Province)</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="age" class="form-label">Age <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="age" name="age"
                                        min="16" max="100" required <?php echo $disableUpload ? 'disabled' : ''; ?>>
                                    <small class="text-muted">Enter your current age (must be at least 16)</small>
                                </div>
                                
                                <!-- 2x2 Image Upload Section -->
                                <div class="mb-3">
                                    <label for="image_2x2" class="form-label">2x2 ID Picture <span class="text-danger">*</span></label>
                                    <input type="file" class="form-control" id="image_2x2" name="image_2x2" 
                                        accept=".jpg,.jpeg,.png" required <?php echo $disableUpload ? 'disabled' : ''; ?>>
                                    <small class="text-muted">Upload a recent 2x2 ID picture (JPG, JPEG, or PNG format, max 2MB)</small>
                                    <div id="image-preview" class="mt-2 d-none">
                                        <img src="" alt="Image Preview" style="max-width: 150px; max-height: 150px;" class="img-thumbnail">
                                    </div>
                                </div>
                                
                                <!-- Document Upload Section -->
                                <h4 class="mb-3 mt-4">Upload Supporting Document</h4>
                                
                                <div class="instructions-card mb-4">
                                    <h5><i class="bi bi-info-circle"></i> Important Instructions</h5>
                                    <ul>
                                        <li>The document must be in PDF format.</li>
                                        <li>The file size should not exceed 5MB.</li>
                                        <li>The document must contain both 1st Grading and 2nd Grading information.</li>
                                        <li>Make sure the document is clear and readable.</li>
                                        <li>All information in the document must be accurate and complete.</li>
                                    </ul>
                                </div>
                                
                                <div class="custom-file-upload mb-4" id="dropZone">
                                    <input type="file" class="d-none" id="pdf_file" name="pdf_file" accept=".pdf" required <?php echo $disableUpload ? 'disabled' : ''; ?>>
                                    <i class="bi bi-cloud-arrow-up upload-icon"></i>
                                    <h5 class="mt-3">Drag and drop your PDF file here</h5>
                                    <p class="text-muted">or</p>
                                    <button type="button" class="btn btn-outline-primary" id="browseBtn" <?php echo $disableUpload ? 'disabled' : ''; ?>>Browse Files</button>
                                    <div id="file-name" class="mt-3 text-success fw-bold"></div>
                                </div>
                                
                                <!-- ML Classifier Scan Results -->
                                <div id="ml-scan-results" class="mb-4" style="display: none;">
                                    <div class="card">
                                        <div class="card-header bg-info text-white">
                                            <h6 class="mb-0">
                                                <i class="bi bi-robot"></i> AI Document Analysis
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="scan-loading" class="text-center" style="display: none;">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Scanning...</span>
                                                </div>
                                                <p class="mt-2 mb-0">Analyzing document with AI...</p>
                                                <small class="text-muted">Checking for report card format and failed remarks</small>
                                            </div>
                                            
                                            <div id="scan-results" style="display: none;">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <h6><i class="bi bi-file-earmark-text"></i> Document Type</h6>
                                                        <span id="document-type" class="badge fs-6"></span>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <h6><i class="bi bi-check-circle"></i> Academic Status</h6>
                                                        <span id="document-status" class="badge fs-6"></span>
                                                    </div>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <h6><i class="bi bi-info-circle"></i> Analysis Details</h6>
                                                    <div id="analysis-details" class="alert alert-light"></div>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <h6 class="mb-0"><i class="bi bi-list-ul"></i> Extracted Information</h6>
                                                        <button type="button" class="btn btn-sm btn-outline-info" id="toggle-extracted-text">
                                                            <i class="bi bi-eye"></i> Show Details
                                                        </button>
                                                    </div>
                                                    <div id="extracted-text" class="bg-light p-3 rounded mt-2" style="max-height: 200px; overflow-y: auto; display: none;"></div>
                                                </div>
                                                
                                            </div>
                                            
                                            <div id="scan-error" class="alert alert-danger" style="display: none;">
                                                <i class="bi bi-exclamation-triangle"></i>
                                                <span id="error-message"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-grid">
                                    <button type="submit" class="btn btn-psau btn-lg" id="submitBtn" <?php echo $disableUpload ? 'disabled' : ''; ?>>Submit Application</button>
                                </div>
                            </form>
                        <?php endif; ?>
                    </div>
                </div>
                
                <div class="col-lg-4 mt-4 mt-lg-0">
                    <div class="card">
                        <div class="card-header bg-psau text-white">
                            <h5 class="mb-0">Applicant Information</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Name:</strong> <?php echo htmlspecialchars($user['first_name'] . ' ' . $user['last_name']); ?></p>
                            <p><strong>Control Number:</strong> <?php echo htmlspecialchars($user['control_number']); ?></p>
                            <p><strong>Email:</strong> <?php echo htmlspecialchars($user['email']); ?></p>
                            <p><strong>Mobile:</strong> <?php echo htmlspecialchars($user['mobile_number']); ?></p>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header bg-psau text-white">
                            <h5 class="mb-0">Application Status</h5>
                        </div>
                        <div class="card-body">
                            <?php if ($canSubmit): ?>
                                <p class="text-center">You can submit an application.</p>
                            <?php else: ?>
                                <p class="text-center">You cannot submit an application.</p>
                            <?php endif; ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Custom JavaScript -->
    <script src="js/application_form_simple.js"></script>
</body>
</html> 